<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RAM ALERTA - CENTRAL T√ÅTICA</title>
    
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">

    <style>
        /* PALETA DE CORES T√ÅTICA E NEON */
        :root { 
            --fire: #ff1a1a; 
            --bg: #050505; 
            --card: rgba(20, 20, 22, 0.85); 
            --info: #00e5ff; 
            --yellow: #ffcc00; 
            --glass-border: rgba(255, 255, 255, 0.08);
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: #ffffff; 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
            /* Fundo radial sutil para profundidade */
            background-image: radial-gradient(circle at 50% 0%, #2a0000 0%, #050505 60%);
            background-attachment: fixed;
        }

        /* 1. BARRA DE CARREGAMENTO (TOPO) */
        .refresh-bar { 
            position: fixed; top: 0; left: 0; height: 3px; 
            background: linear-gradient(90deg, transparent, var(--fire), var(--yellow), transparent); 
            background-size: 200% 100%;
            z-index: 4000; 
            animation: loading-bar 20s linear infinite; 
            box-shadow: 0 0 10px var(--fire); 
        }
        @keyframes loading-bar { 0% { width: 0%; background-position: 100% 0; } 100% { width: 100%; background-position: -100% 0; } }

        /* 2. TICKER DE INFORMA√á√ÉO ROLANTE */
        .ticker-wrap { 
            position: sticky; top: 0; width: 100%; overflow: hidden; 
            background: rgba(5, 5, 5, 0.85); 
            border-bottom: 1px solid var(--fire); 
            z-index: 3000; 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
        }
        .ticker { display: flex; white-space: nowrap; padding: 10px 0; animation: ticker 25s linear infinite; }
        .ticker-item { padding: 0 30px; color: #fff; font-weight: 800; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .container { padding: 15px; padding-bottom: 140px; }

        /* 3. CAIXA DO LOG√ìTIPO COM SINO (SUBSCRITORES) */
        .identity-box {
            width: 100%; height: 180px; border-radius: 20px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(10, 10, 10, 0.6); 
            border: 1px solid var(--glass-border); 
            box-shadow: 0 8px 32px rgba(255, 0, 0, 0.15);
            margin-bottom: 15px; position: relative; overflow: hidden;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .identity-box::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: conic-gradient(transparent, rgba(255,26,26,0.1), transparent 30%);
            animation: rotate-glow 6s linear infinite;
        }
        @keyframes rotate-glow { 100% { transform: rotate(360deg); } }
        
        .group-logo { max-width: 85%; max-height: 130px; object-fit: contain; z-index: 2; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); transition: transform 0.3s ease; }
        .identity-box:active .group-logo { transform: scale(0.95); }

        .sub-btn {
            position: absolute; top: 12px; right: 12px;
            background: rgba(255, 204, 0, 0.15); border: 1px solid rgba(255, 204, 0, 0.4);
            color: var(--yellow); padding: 10px; border-radius: 50%;
            cursor: pointer; z-index: 10; 
            animation: smooth-ring 3s infinite ease-in-out;
            text-decoration: none; font-size: 1.2rem;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
        }
        @keyframes smooth-ring { 0%, 100% { transform: rotate(0); } 5%, 15% { transform: rotate(10deg); } 10%, 20% { transform: rotate(-10deg); } 25% { transform: rotate(0); } }

        /* 4. DASHBOARD (M√âTRICAS) */
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .dash-box { 
            background: var(--card); border-radius: 16px; padding: 15px; 
            border: 1px solid var(--glass-border); text-align: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
        }
        .clock { font-size: 1.6rem; font-weight: 900; letter-spacing: 1px; }
        .weather-val { font-size: 1.4rem; font-weight: 900; color: var(--info); text-shadow: 0 0 10px rgba(0, 229, 255, 0.3); }
        .dash-label { font-size: 0.6rem; color: #888; text-transform: uppercase; font-weight: 800; margin-top: 4px; letter-spacing: 1px;}

        /* 5. BOT√ïES DE ACESSO R√ÅPIDO */
        .btn-link { 
            background: var(--card); color: #fff; text-decoration: none; padding: 16px; 
            border-radius: 16px; display: block; margin-bottom: 12px; 
            border: 1px solid var(--glass-border); font-weight: 800; text-align: center; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            font-size: 0.9rem; letter-spacing: 0.5px;
        }
        .btn-link:active { transform: scale(0.97); background: rgba(40, 40, 45, 0.9); }
        
        .btn-radar { 
            background: linear-gradient(135deg, #0033cc, #00bfff); border: none; 
            text-transform: uppercase; box-shadow: 0 4px 15px rgba(0, 191, 255, 0.3);
        }
        
        .btn-112 { 
            background: linear-gradient(135deg, #cc0000, #ff1a1a); border: none; 
            font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px;
            animation: soft-pulse 2s infinite; color: white;
        }
        @keyframes soft-pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 26, 26, 0.5); } 70% { box-shadow: 0 0 0 12px rgba(255, 26, 26, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 26, 26, 0); } }

        /* CONTACTOS VIA LITORAL/EXPRESSO (Fundo Escuro, Letras Amarelas) */
        .btn-yellow-text { 
            color: var(--yellow) !important; 
            text-shadow: 0 0 8px rgba(255, 204, 0, 0.4); 
            font-size: 0.85rem; 
        }

        /* 6. CART√ïES DE ALERTA DIN√ÇMICOS */
        .alert-card { 
            background: var(--card); border-radius: 16px; padding: 16px; margin-bottom: 12px; 
            border-left: 5px solid var(--fire); 
            animation: slideUp 0.4s ease-out forwards;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            opacity: 0; transform: translateY(15px);
        }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
        
        .alert-meta { font-size: 0.75rem; color: #aaa; margin-bottom: 6px; font-weight: 800; display: flex; align-items: center; gap: 5px; }
        .alert-msg { font-weight: 800; color: #f0f0f0; text-transform: uppercase; font-size: 0.9rem; line-height: 1.4; }
        
        /* Efeito visual para acidentes (suave para n√£o causar vertigens) */
        .danger { border-left-color: var(--yellow); background: linear-gradient(90deg, rgba(255,204,0,0.08) 0%, rgba(20,20,22,0.85) 50%); }

        /* 7. BARRA DE NAVEGA√á√ÉO INFERIOR */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: rgba(10, 10, 10, 0.95); display: flex; gap: 10px; padding: 15px; 
            border-top: 1px solid var(--glass-border); z-index: 3000; 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        .nav-item { 
            flex: 1; text-align: center; padding: 12px; border-radius: 12px; 
            text-decoration: none; font-weight: 800; color: white; font-size: 0.75rem; 
            text-transform: uppercase; transition: transform 0.2s;
        }
        .nav-item:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div class="refresh-bar"></div>
    
    <div class="ticker-wrap">
        <div class="ticker" id="ticker-content">A SINCRONIZAR REDE DE ALERTAS RAM...</div>
    </div>

    <div class="container">
        
        <div class="identity-box">
            <a href="#" onclick="alert('Notifica√ß√µes ativadas com sucesso!')" class="sub-btn" title="Subscrever Alertas">üîî</a>
            <img src="logo.png" alt="Log√≥tipo RAM Alerta" class="group-logo" onerror="this.src='https://via.placeholder.com/300x120/111/ff1a1a?text=RAM+ALERTA'">
        </div>

        <a href="https://www.vialitoral.com/map" target="_blank" class="btn-link btn-radar">üì° MONITOR RADAR (VIALITORAL)</a>

        <div class="dashboard">
            <div class="dash-box">
                <div class="clock" id="clock">00:00:00</div>
                <div class="dash-label" style="color:var(--fire);">HORA LOCAL (24H)</div>
            </div>
            <div class="dash-box">
                <div id="weather-info" class="weather-val">--¬∞C</div>
                <div id="rain-info" class="dash-label">A CARREGAR...</div>
            </div>
        </div>

        <div style="display: flex; gap: 12px; margin-bottom: 12px;">
            <a href="tel:800205215" class="btn-link btn-yellow-text" style="flex:1;">800 205 215<br><span style="font-size:0.65rem; color:#888;">VIA LITORAL</span></a>
            <a href="tel:800241241" class="btn-link btn-yellow-text" style="flex:1;">800 241 241<br><span style="font-size:0.65rem; color:#888;">VIA EXPRESSO</span></a>
        </div>

        <a href="https://www.vialitoral.com/mapa/" target="_blank" class="btn-link" style="border-color: rgba(0, 229, 255, 0.3); color: var(--info);">üìπ C√ÇMARAS EM DIRETO</a>
        <a href="tel:112" class="btn-link btn-112">üöë 112 EMERG√äNCIA</a>
        
        <div id="feed" style="margin-top: 20px; text-align: center; color: #888; font-weight: bold; font-size: 0.9rem;">
            A procurar ocorr√™ncias...
        </div>
    </div>

    <div class="bottom-nav">
        <a href="https://www.facebook.com/share/g/1ATEH8rvEb/" class="nav-item" style="background: linear-gradient(135deg, #1877F2, #0b59c7);">FACEBOOK</a>
        <a href="https://t.me/acidenteseocorrenciasnaram" class="nav-item" style="background: linear-gradient(135deg, #0088cc, #006699);">TELEGRAM</a>
    </div>

    <script>
        // 1. MOTOR DE REL√ìGIO (Formato 24 Horas Estrito)
        function updateClock() { 
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('pt-PT', {hour12: false}); 
        }
        setInterval(updateClock, 1000); 
        updateClock();

        // 2. MOTOR METEOROL√ìGICO (Com preven√ß√£o de falhas)
        async function checkWeather() {
            const tempEl = document.getElementById('weather-info');
            const rainEl = document.getElementById('rain-info');
            try {
                // Fetch focado no Funchal com par√¢metros estritos
                const res = await fetch("https://api.open-meteo.com/v1/forecast?latitude=32.65&longitude=-16.90&current_weather=true&hourly=precipitation_probability&timezone=Europe%2FLisbon");
                if (!res.ok) throw new Error("API Indispon√≠vel");
                const data = await res.json();
                
                tempEl.innerText = `${Math.round(data.current_weather.temperature)}¬∞C`;
                rainEl.innerText = `${data.hourly.precipitation_probability[new Date().getHours()] || 0}% CHUVA`;
            } catch (e) {
                tempEl.innerText = "--¬∞C";
                rainEl.innerText = "S/ LIGA√á√ÉO";
                // Tenta reconectar ap√≥s 10 segundos em caso de falha de rede
                setTimeout(checkWeather, 10000);
            }
        }

        // 3. MOTOR DE DADOS E ORDENA√á√ÉO (Excel)
        async function fetchAlerts() {
            try {
                const res = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQEfr4nu_M1gVlE2d2cUZdpgKwVgffuXMlNk5VSpxu9yJwVOCvnekQTwJ82BezSGTiMT0CCnXxkK_tI/pub?gid=0&single=true&output=csv&t=" + new Date().getTime());
                const text = await res.text();
                const lines = text.split(/\r?\n/).slice(1);
                
                let alerts = []; 
                let tickerHtml = "";
                
                lines.forEach(line => {
                    // Regex robusto para separar CSV ignorando v√≠rgulas dentro de aspas
                    const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if(cols[2] && cols[2].trim() !== "") {
                        let rawTime = (cols[0] || "").replace(/"/g, '').trim();
                        let local = (cols[1] || "").replace(/"/g, '').trim();
                        let msg = (cols[2] || "").replace(/"/g, '').trim();
                        
                        // Extra√ß√£o for√ßada de hora em formato HH:MM (24h)
                        let timeMatch = rawTime.match(/\b([01]?[0-9]|2[0-3]):([0-5][0-9])\b/);
                        let timeTxt = timeMatch ? timeMatch[0] : rawTime.substring(0,5);
                        
                        // Cria√ß√£o de um valor matem√°tico para ordena√ß√£o perfeita
                        let sortValue = 0;
                        if(timeMatch) {
                            sortValue = (parseInt(timeMatch[1]) * 60) + parseInt(timeMatch[2]);
                        }
                        
                        alerts.push({ time: timeTxt, local: local, msg: msg, sortValue: sortValue });
                        tickerHtml += `<span class="ticker-item">‚ö†Ô∏è ${local}: ${msg}</span> `;
                    }
                });

                // Ordena√ß√£o cronol√≥gica rigorosa: do mais recente (maior valor) para o mais antigo
                alerts.sort((a,b) => b.sortValue - a.sortValue);
                
                let html = '';
                alerts.slice(0, 15).forEach((a, index) => {
                    const isDanger = a.msg.toUpperCase().includes("ACIDENTE") || a.msg.toUpperCase().includes("RETEN√á√ÉO");
                    // Anima√ß√£o em cascata (delay baseado no index)
                    const delay = index * 0.1; 
                    
                    html += `
                        <div class="alert-card ${isDanger ? 'danger' : ''}" style="animation-delay: ${delay}s">
                            <div class="alert-meta">
                                <span style="color:var(--yellow); font-size:0.9rem;">üïí</span> ${a.time} ‚Ä¢ ${a.local}
                            </div>
                            <div class="alert-msg">${a.msg}</div>
                        </div>`;
                });
                
                document.getElementById('feed').innerHTML = html || "VIA R√ÅPIDA SEM OCORR√äNCIAS REGISTADAS.";
                if(tickerHtml) document.getElementById('ticker-content').innerHTML = tickerHtml;
                
            } catch (e) {
                document.getElementById('feed').innerHTML = "Falha na sincroniza√ß√£o. A tentar novamente...";
            }
        }

        // Inicializa√ß√£o dos motores
        checkWeather(); 
        fetchAlerts(); 
        
        // Loops de atualiza√ß√£o
        setInterval(fetchAlerts, 20000); // Alertas a cada 20s
        setInterval(checkWeather, 300000); // Meteorologia a cada 5 mins
    </script>
</body>
</html>
